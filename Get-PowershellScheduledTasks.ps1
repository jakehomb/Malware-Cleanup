function Get-PowerShellScheduledTasks {
    $Tasks = Get-ScheduledTask

    foreach ($Task in $Tasks) {
        foreach ($Action in $Task.Actions) {
            if ($Action.Execute -match "powershell.exe") {
                Write-Host "[*] Task found: $($Task.TaskName)"
                Write-Host "`t Created: $(Get-ScheduledTaskCreationTime $Task.TaskName)"
                Write-Host "`t Command: $($Action.Execute)"
                Write-Host "`t Arguments: $($Action.Arguments)"
            } elseif ($Action.Arguments -match "powershell") {
                Write-Host "[*] Task found: $($Task.TaskName)"
                Write-Host "`t Created: $(Get-ScheduledTaskCreationTime $Task.TaskName)"
                Write-Host "`t Command: $($Action.Execute)"
                Write-Host "`t Arguments: $($Action.Arguments)"
            }
        }
    }
}


function Get-ScheduledTaskCreationTime {
    param(
        $TaskName
    )
    $DirPath = "C:\\Windows\\System32\\Tasks\\$TaskName"
    $Task = Get-ChildItem $DirPath
    return $Task[0].CreationTime
}

Get-PowerShellScheduledTasks
